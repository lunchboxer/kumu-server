type User {
  id: ID! @id
  username: String! @unique
  password: String!
  createdAt: DateTime! @createdAt
  updatedAt: DateTime! @updatedAt
  role: Role
}

enum Role {
  Admin
}

type Student {
  id: ID! @id
  chineseName: String
  englishName: String
  pinyinName: String
  birthdate: DateTime
  gender: Gender
  groups: [Group!]!
  points: [Point!]! @relation(onDelete: CASCADE)
  attendances: [Attendance!]! @relation(onDelete: CASCADE)
  createdAt: DateTime! @createdAt
  updatedAt: DateTime! @updatedAt
}

enum Gender {
  M
  F
}

type Group {
  # a group of students attending class together
  id: ID! @id
  name: String!
  students: [Student!]! @relation(onDelete: SET_NULL)
  classSessions: [ClassSession!]!
  semester: Semester! @relation(link: INLINE)
  createdAt: DateTime! @createdAt
  updatedAt: DateTime! @updatedAt
}

type ClassSession {
  id: ID! @id
  startsAt: DateTime!
  startedAt: DateTime
  endsAt: DateTime!
  endedAt: DateTime
  group: Group! @relation(link: INLINE)
  points: [Point!]! @relation(onDelete: CASCADE)
  attendances: [Attendance!]! @relation(onDelete: CASCADE)
  stage: Stage! @default(value: Inactive)
  lesson: Lesson @relation(link: INLINE)
  summary_EN: String
  summary_ZH: String
  published: Boolean! @default(value: false)
  createdAt: DateTime! @createdAt
  updatedAt: DateTime! @updatedAt
}

type Semester {
  id: ID! @id
  startDate: DateTime!
  endDate: DateTime!
  name: String! @unique
  groups: [Group!]!
  createdAt: DateTime! @createdAt
  updatedAt: DateTime! @updatedAt
}

type Point {
  # points awarded to students during the lesson, can be positive or negative
  id: ID! @id
  value: Int!
  student: Student! @relation(link: INLINE)
  classSession: ClassSession! @relation(link: INLINE)
  createdAt: DateTime! @createdAt
  updatedAt: DateTime! @updatedAt
}

# used in ClassSession
enum Stage {
  Inactive # scheduled, but teacher hasn't viewed
  Active # preclass, time for attendance
  Started # class time
  Ended # teacher has ended the class
}

type Attendance {
  classSession: ClassSession!
  id: ID! @id
  student: Student! @relation(link: INLINE)
  status: AttendanceStatus! @relation(link: INLINE)
  arrivedAt: DateTime
  createdAt: DateTime! @createdAt
  updatedAt: DateTime! @updatedAt
}

type Tag {
  id: ID! @id
  name: String!
}

type Lesson {
  id: ID! @id
  name: String!
  tags: [Tag!]!
  words: [Word!]!
  summary_EN: String
  summary_ZH: String
  materials: [Material!]!
}

type Material {
  id: ID! @id
  tags: [Tag!]!
  type: String
  url: String
  title: String
  notes: String
}

type Word {
  id: ID! @id
  english: String!
  chinese: String
  audio: String
  lessons: [Lesson!]!
  tags: [Tag!]!
}

# used in Attendance
enum AttendanceStatus {
  Absent
  Present
  Late
  LeftEarly
  LateLeftEarly
}

type Message {
  id: ID! @id
  data: Json
  createdAt: DateTime! @createdAt
}

type Viewer {
  id: ID! @id
  name: String
  createdAt: DateTime! @createdAt
}
